!function(a,b){"use strict";wp.customize.controlConstructor["vamtam-background"]=wp.customize.Control.extend({ready:function(){var a=this;a.setupColor(),_.bindAll(a,"restoreDefault","removeFile","openFrame","select"),a.container.on("click keydown",".upload-button",a.openFrame),a.container.on("click keydown",".thumbnail-image img",a.openFrame),a.container.on("click keydown",".default-button",a.restoreDefault),a.container.on("click keydown",".remove-button",a.removeFile),a.container.on("change","select",function(){var b={};b[this.dataset.key]=this.value,a.setBackground(b)}),a.setting.bind(function(){a.renderContent(),a.setupColor()})},setupColor:function(){var a=this,b=a.container.find(".vamtam-bg-color");b.val(a.setting()["background-color"]).wpColorPicker({change:function(){a.setBackground({"background-color":b.wpColorPicker("color")})},clear:function(){a.setBackground({"background-color":""})}})},openFrame:function(a){wp.customize.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var a=this.frame.state().get("selection").first().toJSON();this.setImage(a)},restoreDefault:function(a){wp.customize.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.setImage(this.params.default["background-image"]),this.setBackground(this.params.default))},removeFile:function(a){wp.customize.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.setImage({}),this.renderContent(),this.setupColor())},setImage:function(a){this.params.bg=_.extend({},this.params.bg,{"background-image":a}),this.setting.set(_.extend({},this.setting(),{"background-image":a.url||""}))},setBackground:function(a){var b=this.setting.get();this.params.bg=_.extend({"background-repeat":"no-repeat","background-size":"auto","background-attachment":"fixed","background-position":"left top"},this.params.bg,a),this.setting.set(_.extend({"background-repeat":"no-repeat","background-size":"auto","background-attachment":"fixed","background-position":"left top"},b,a))}})}(jQuery);