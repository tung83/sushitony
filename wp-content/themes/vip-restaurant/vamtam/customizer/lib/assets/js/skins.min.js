!function(a){"use strict";wp.customize.controlConstructor["vamtam-skins"]=wp.customize.Control.extend({decode_html:function(a){var b=document.createElement("textarea");return b.innerHTML=a,b.value},request:function(b,c){var d=this;b.nonce=d.params.nonce,b.action="vamtam-customizer-control",b.control="skins",a.post(ajaxurl,b,function(b){if(a.isNumeric(b)||!("nonce"in b))return void alert(d.decode_html(d.params.l10n.auth_expired));"data"in b&&c(b.data),d.params.nonce=b.nonce})},load_available:function(){var b=this;b.request({method:"available",prefix:b.params.prefix},function(c){a("#import-config-available",b.container).html(c)})},show_spinner:function(){var b=this;b.spinner=a(".spinner",b.container).css({display:"inline-block",visibility:"visible"})},show_result:function(b){var c=this;console.log(c),c.load_available(),c.spinner.hide(),a(".result",c.container).html(b),setTimeout(function(){a(".result",c.container).fadeOut("fast",function(){a(this).html("").show()})},3e3)},remove:function(a){var b=this;b.show_spinner(),b.request({method:"delete",file:a},function(a){b.show_result(a)})},save:function(a){var b=this;a.match(/^\s*$/)||(b.show_spinner(),b.request({method:"save",file:a},function(a){b.show_result(a)}))},load:function(b){var c=this;c.show_spinner(),a("body").append(a("<div></div>").css({position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1e6,background:"rgba( 0, 0, 0, 0.2 )"})),c.request({method:"import",file:b},function(a){c.show_result(a),window.onbeforeunload=null,setTimeout(function(){window.location.reload()},500)})},ready:function(){var b=this;b.container&&(b.load_available(),a("#export-config",b.container).click(function(){var c=a("#export-config-name",b.container).val().replace(/^\s+/,"").replace(/\s+$/,"");c.length&&b.save(b.params.prefix+"_"+c)}),a("#delete-config",b.container).click(function(){var c=a("#import-config-available :selected",b.container).text();!a("#import-config-available",b.container).val().match(/^\s+$/)&&window.confirm(b.decode_html(b.params.l10n.delete_confirm.replace("%s",c)))&&b.remove(b.params.prefix+"_"+c)}),a("#import-config",b.container).click(function(){var c=a("#import-config-available :selected",b.container).text();window.confirm(b.decode_html(b.params.l10n.import_confirm.replace("%s",c)))&&b.load(b.params.prefix+"_"+c)}))}})}(jQuery);